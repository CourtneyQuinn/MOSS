\documentclass[compress,handout]{beamer}
% use handout option for one slide per page
\mode<presentation>

\usetheme{Frankfurt} 
%regular LaTeX title/author info
%\AtBeginSection[]{} % for optional outline or other recurrent slide

\usecolortheme{seahorse}
\definecolor{darkgreen}{rgb}{0,0.7,0}

\usepackage[percent]{overpic}
\newcommand{\eqcolor}{blue} 
\newcommand{\txtcolor}{black} 

\input{./packages.tex} 
\input{./macros_TS.tex}
\input{./nots_TS.tex}

% \+{\dt}{h}

% for MC diagrams                               
\usepackage{tikz}                               
\usetikzlibrary{arrows}                         

\usepackage{dcolumn} % for decimal point column alignment in tables

%: Specific notations 
% Specific notations: highlighted while in draft 
% \newcommand{\CAH}[1]{{\boldsymbol{\color{magenta}#1}}}
% \newcommand{\CAL}[1]{{\boldsymbol{\color{cyan}#1}}}
% \newcommand{\CAS}[1]{{\boldsymbol{\color{darkgreen}#1}}}

\everymath{\color{\eqcolor}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://tex.stackexchange.com/questions/33969/changing-font-size-of-selected-slides-in-beamer
% \usepackage{lipsum} % lorem ipsum

% \newcommand\Fontvi{\footnotesize\selectfont}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Analysis of Numerical Methods for Markov Chain Models of Ionic Channels}
\author{Tom\'a\v s Star\'y, Vadim N. Biktashev }
\institute{\footnotesize 
  College of Engineering, Mathematics and Physical Sciences \\[1ex]
  \includegraphics[width=0.3\linewidth]{fig/exeLogo.pdf} 
}
\date{\it
  British Applied Mathematics Colloquium, Oxford, \\
  Fri 8 Apr, 2016
}


% \useoutertheme[subsection=false]{smoothbars}

% \setbeamertemplate{note page}[plain]

% \newcommand{\compresslist}{ % Define a command to reduce spacing within itemize/enumerate environments, this is used right after \begin{itemize} or \begin{enumerate}
% \setlength{\itemsep}{1pt}
% \setlength{\parskip}{0pt}
% \setlength{\parsep}{0pt}
% }

\newcommand{\highlight}[1]{\boxed{#1}}

\begin{document}
 
% title page
\frame{	\titlepage }

% outline
% \section[Outline]{}
% \frame{\tableofcontents}

% \subsection{Cellular Membrane}

\section{Introduction}
\subsection{Cellular Membrane}
\begin{frame}
  \frametitle{Cellular Membrane}
  Capacitor equation describing a single cell
  {\color{\eqcolor}
  \begin{align*}
    \ddt{\vm} = -\frac{1}{\Cm} \sum_{k} \Im_k(\vm,\c,\Pop)
  \end{align*}}
      \vspace{-1.5em}
  \begin{itemize}
  \item $\vm(t)$, $\Cm$  -- membrane voltage and capacitance
  \item $\Im_k(\vm,\c,\Pop)$ -- ionic currents
  \item $\c(t)$ -- ionic concentrations
  \item $\Pop(t)$ -- open probability of ionic channel
  \end{itemize}
\end{frame}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Ion Channel}
\begin{frame}
  \frametitle{Ion Channel}
  % Composed of {\em gates}:
  % {\color{\eqcolor}
  %   \begin{align*}
  %     \ddt{\y} = \alpha(\vm) (1-\y) - \beta(\vm) \y 
  %   \end{align*}}
  % % 
  % \begin{itemize}
  % \item $\y$ -- open probability of the gate

  % \item $\alpha$ -- opening transition rate
  % \item $\beta$ -- closing transition rate
  % \item $\vm$ -- membrane voltage
  % \end{itemize}
  % %
  % \uncover<2>{
  % Generalized by
  {\em Markov chain} states
  {\color{\eqcolor}
    \begin{align*}
      \ddt{\vec \x} = \mM(\vm,\c)\, \vec \x
    \end{align*}}
        \vspace{-1.5em}
  % 
  \begin{itemize}
  \item $\vec\x$ -- conductive (open) and non-conductive states:
    {\color{\eqcolor}$$\Pop(t) = \sum\x_\mathrm{open}$$}
      \vspace{-1.5em}
  \item $\mM$ -- transition rates matrix
  \end{itemize}
  % }% uncover 2

  \uncover<2->{
  Time-stepping through time discretization $\t_n = \t_0 + n \dt$ \\
  e.g. simplest -- forward Euler method:
  {\color{\eqcolor}
    \begin{align*}
      \vec\x_{n+1} = \vec\x_n + \dt \ddt{\vec\x_n}
    \end{align*}}
  %
  \vspace{-1.5em}
  \begin{multicols}{2}
    \begin{itemize}
    \item $\vec\x_n\approx\vec\x(\t_n)$
    \item $\dt$ -- time step
    \end{itemize}
  \end{multicols}
  }
  \uncover<3->{\emph{Numerically unstable} for large $\dt$.\\[1.5ex]}

\end{frame}

\section{Methods}
\subsection{Exponential Integration}
\begin{frame}
  \frametitle{Exponential Integration}
  % We extend the exponential time differentiation for Markov chain
  Approximation by ``freezing'' $\mM(\vm(t),\c(t))\approx\mM(\vm_n,\c_n)$ gives
  {\color{\eqcolor}
    \begin{align*}
      \vec \x_{n+1} = \exp\left(\mM(\vm_n,\c_n) \dt \right) \vec \x_n 
    \end{align*}}
  \uncover<2->{
    Matrix exponential:
    % 
    {% \scriptsize
      \color{\eqcolor}
      \begin{align*}
        \Tab= \exp\left(\mM \dt \right) =
          \eM\exp{(\eD \dt)}\eM^{-1}
      \end{align*}}
    \begin{itemize}
      \vspace{-0.5em}
    \item $\mM = \eM \eD \eM^{-1}$ -- eigenvalue decomposition
    \item matrices: $\eM$ -- e-vectors in columns, $\eD$ -- e-values on diagonal
    \end{itemize}
    }% uncover 2
    \uncover<3->{
      Tabulation:
      \begin{itemize}
      \item save $\eM(\vm_j), \eD(\vm_j)$ for a fine grid of dependent variable
      \end{itemize}
      }
\end{frame}

\section{Application}
\subsection{Case 1: RyR Channel}

\begin{frame}
  \frametitle{Case 1: RyR Channel}
  \begin{minipage}{0.40\linewidth}
    \input{ryrmc.tex}    \vspace{3.50em}\\
    \uncover<2->{
    \includegraphics[width=1.0\linewidth]{ryr-tr.pdf}}\\
    \uncover<3->{
      \includegraphics[width=1.0\linewidth]{ryr-inst.pdf}}\\
  \end{minipage}
  \begin{minipage}{0.58\linewidth}
    % \uncover<4->{
    %   \begin{tabular}[t]{l|l|l}
    %   $\caiss(\t)$& $\csqn$& const.\\
    %   \hline
    %   \uncover<5->{$\alp{}$'s}\uncover<8->{, $\gam{}$'s}&
    %   \uncover<7->{$\del{}$'s}&
    %   \uncover<6->{$\bet{}$'s}\\
    % \end{tabular}}
    \uncover<2->{
      Transition rates:
      {\scriptsize
      \color{\eqcolor}
      \begin{align*}
        \mM(\caiss,\csqn)
        \uncover<4->{=
        \left(\begin{array}{l|l}
                \mB & 0 \\\hline 
                0 & \mB 
              \end{array}\right)+}
                    \uncover<5->{\mC}
                    \uncover<4>{\hspace{-1em}\hdots}
      \end{align*}}}
    \uncover<4->{    
      \begin{itemize}
      \item  $\alp{}$'s, $\bet{}$'s -- fast $\mB(\caiss(\t))$
        \uncover<5->{\item $\gam{}$'s, $\del{}$'s -- slow  $\mC(\dots)$}
      % $\norm{\mC(\dots)}\lesssim1\,\ms^{-1}$
    \end{itemize}}
    % Forward Euler limited by instability issues for $dt \ge 7$.
    \uncover<6->{
      Solved in sub-steps as
    {\color{\eqcolor}
    \begin{align*}
      &\vec\vv_{n+1/2}=\exp\left(\dt\,\mB(\t_n)\right)\,\vec\vv_n\\
      &\vec \w_{n+1/2}=\exp\left(\dt\,\mB(\t_n)\right)\,\vec \w_n\\
\uncover<7->{      &\vec\u_{n+1}  =\vec\u_{n+1/2} 
      + \dt\,\mC(\t_n)\,\vec\u_{n+1/2}}
    \end{align*}}
  where $\vec{v}=(I_1, \dots, I_5)$,\\ $\vec{\w}=(C_1,\dots,C_4,O_1)$ 
\uncover<7->{  and $\vec \u =(\vec \vv,\vec \w)$.}}
  \end{minipage}
\end{frame}

\subsection{Case 2: ical Channel}

\begin{frame}
  \frametitle{Case 2: $\ical$ Channel}
  \begin{minipage}{0.50\linewidth}
  \input{icalmc.tex}
  \end{minipage}
  \begin{minipage}{0.48\linewidth}
    \begin{itemize}
    \item forward Euler instability at $\sim 37$~$\mus$ 
        \uncover<2->{\item two identical layers with \\ $\vm$ dependent transitions}
        \uncover<3->{\item vertical trans. controlled by $\cai$ dependent $\delta$, $\theta$}
          \uncover<4->{
          \item Simplifies as
            \begin{itemize}
            \item a single layer $\ddt{\vec \x} = \mM(\vm) \vec \x $
              % {\color{\eqcolor}
                % \begin{align*}
                %   &\ddt{\vec \x} = \mM(\vm) \vec \x 
                % \end{align*}}
            }
            \uncover<5->{
            \item and a gate model $\ddt{\q} = \theta (1-\q) - \delta \q$
              % \begin{align*}
              %   \hspace{-3em}\ddt{\q} = \theta(\cai) (1-\q) -\\ \delta(\cai) \q
              % \end{align*}
            }
          \end{itemize}

    \end{itemize}
  \end{minipage}\vspace{3.0em}\\
  \uncover<6->{
    \begin{itemize}
    \item Exponential solvers applied for both parts
    \item Open probability $\Pop(t) = \q(t) O(t)$
    \end{itemize}
  }  
\end{frame}

\section{Results and Conclusions}
\subsection{}
\begin{frame}
  \frametitle{Results and Conclusions}
  \includegraphics[width=1.0\linewidth]{summeth.pdf}

    % \begin{minipage}{0.5\linewidth}
      \begin{itemize}
        \uncover<2->{ \item Time step increase from $\sim 6$~$\mus$ to
          $\sim 180$~$\mus$}
        \uncover<2->{\item 27-fold reduction of computational time}
        \uncover<3->{\item time step limited by accuracy requirements}
        \uncover<3->{ \item instability at higher time steps due to non-gating variables ($\nai$ and $\ki$) }
      \uncover<4->{\item addressing instability allows to consider higher order schemes}
      \end{itemize}
  %   \end{minipage}
  % \begin{minipage}{0.48\linewidth}
  %   \uncover<3->{\includegraphics[width=1.0\linewidth]{tab.pdf}}
  % \end{minipage}
\end{frame}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Conclusions}

\begin{frame}
\begin{thebibliography}{1}

\bibitem{Hodgkin1952}
A.~L. Hodgkin, A.~F. Huxley.
\newblock A quantitative description of membrane current and its application to
  conduction and excitation in nerve.
\newblock {\em J Physiol} 1952, 117(4):500--544.

\bibitem{Rush1978}
S.~Rush, H.~Larsen.
\newblock A practical algorithm for solving dynamic membrane equations.
\newblock {\em IEEE Trans Biomed Eng} 1978, 25(4):389--392.

\bibitem{Faber2007a}
  Faber GM, Silva J, Livshitz L, Rudy Y.
  \newblock Kinetic properties of the cardiac {L}-type {Ca$^{2+}$} channel and
  its role in myocyte electrophysiology: a theoretical investigation.
  \newblock {\em Biophys J} 2007;\hspace{0pt}92(5):1522--1543.

\bibitem{Stary2015}
  T.~Stary, V.~N.~Biktashev
  \newblock Exponential integrators for a Markov chain model of the fast sodium
  channel of cardiomyocytes.
  \newblock {\em IEEE Trans Biomed Eng} 2015;\hspace{0pt}62(4):1070--1076.

\end{thebibliography}
  
\end{frame}







\begin{frame}
  \frametitle{Cellular Membrane}
  Capacitor equation describing a single cell
  {\color{\eqcolor}
  \begin{align*}
    \ddt{\vm} = -\frac{1}{\Cm} \sum_{k} \Im_k(\vm,\c,\Pop)
  \end{align*}}
  %     \vspace{-1.5em}
  % \begin{itemize}
  % \item $\vm(t)$, $\Cm$  -- membrane voltage and capacitance
  % \item $\Im_k(\vm,\c,\Pop)$ -- ionic currents
  % \item $\c(t)$ -- ionic concentrations
  % \item $\Pop(t)$ -- open probability of ionic channel
  % \end{itemize}
  %     \vspace{1em}
  Ohm's law for current through ionic channel
  {\color{\eqcolor}
  \begin{align*}
    \Im = \Gkmax \Pop(t) \Big[\vm(t) - \Em(c)\Big]
  \end{align*}} 
      \vspace{-1.5em}
  \begin{itemize}
  \item $\Gkmax$ -- maximum conductance 
  \item $\Em(c)$ -- equilibrium voltage for specific ion
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Matrix Exponential}
  % % We extend the exponential time differentiation for Markov chain
  % Approximation by ``freezing'' $\mM(\vm(t),\c(t))\approx\mM(\vm_n,\c_n)$ gives
  % {\color{\eqcolor}
  %   \begin{align*}
  %     \vec \x_{n+1} = \exp\left(\mM(\vm_n,\c_n) \dt \right) \vec \x_n 
  %   \end{align*}}
    Matrix exponential:
    % 
    {% \scriptsize
      \color{\eqcolor}
      \begin{align*}
        &\Tab= \exp\left(\mM \dt \right) =
          \sum_{\Ej = 0}^{\infty} \frac{\mM^\Ej \dt^\Ej}{\Ej!}
          \uncover<2->{ = \sum_{\Ej = 0}^{\infty} \frac{(\eM \eD \eM^{-1})^\Ej \dt^\Ej}{\Ej!}}
          \uncover<3->{
          =\\ &\sum_{\Ej = 0}^{\infty} \frac{ \eM \eD \eM^{-1} \eM \eD \eM^{-1} \hdots \eM \eD \eM^{-1}\dt^\Ej}{\Ej!}
                =\sum_{\Ej = 0}^{\infty} \frac{ \eM  \eD \eD \hdots \eD  \eM^{-1}\dt^\Ej}{\Ej!}
                =\\ &\eM\left(\sum_{\Ej = 0}^{\infty} \frac{ \eD^\Ej  \dt^\Ej}{\Ej!}\right)\eM^{-1}}
                                                \uncover<4->{=
                                                \highlight{\eM\exp{(\eD \dt)}\eM^{-1}}
                                                }
      \end{align*}}
    \begin{itemize}
      \vspace{-0.5em}
      \uncover<2->{\item $\mM = \eM \eD \eM^{-1}$ -- eigenvalue decomposition
      \item matrices: $\eM$ -- e-vectors in columns, $\eD$ -- e-values on diagonal}
      \uncover<3->{\item $\eM^{-1} \eM = \I$ -- identity matrix}
      \uncover<3->{\item $\I\eD = \eD$}
  \end{itemize}
\end{frame}

\subsection{Tabulation}
\begin{frame}
  \frametitle{Tabulation}
  To avoid expensive e-values and e-vectors computations at each time step:
    \begin{itemize}
    \uncover<2->{\item save the matrices $\eM(\tvm_j)$ and $\eD(\tvm_j)$ for a fine grid
      of dependent variable% : $\tvm = (-100, 70)$~mV
      % with the step $\dvm = 0.01$~mV ($\tvm_j=\tvm_\mathrm{min} +j\dvm$)
    }
    \uncover<3->{\item find matrix exponential before the integration \\ $\Tab(\tvm) =
      \eM(\tvm) \exp\left( \eD(\tvm) \dt\right)
      \eM^{-1}(\tvm)$}
    \uncover<4->{\item numerical scheme:
      {\color{\eqcolor}
      \begin{align*}
        \color{\eqcolor}
        \vec \x_{n+1} = \Tab(\tvm_{j(n)}) \vec \x_n
      \end{align*}}
    where $\tvm_{j(n)} \approx \vm_n$.}
    \end{itemize}
\end{frame}




\end{document}
