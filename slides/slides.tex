\documentclass[compress]{beamer}
\mode<presentation> 

\usetheme{Frankfurt} 
%regular LaTeX title/author info
%\AtBeginSection[]{} % for optional outline or other recurrent slide

\usecolortheme{seahorse}
\definecolor{darkgreen}{rgb}{0,0.7,0}

\usepackage[percent]{overpic}
\newcommand{\eqcolor}{blue} 
\newcommand{\txtcolor}{black} 

\input{./packages.tex} 
\input{./macros_TS.tex}
\input{./nots_TS.tex}
\+{\Tab}{T}
\+{\Ej}{j}
\+{\eM}{\mat P}
\+{\eD}{\mat \Lambda}
\+{\I}{\mat{\mathrm{I}}}
\+{\q}{q}
\+{\qbar}{\bar{\q}}

% \+{\dt}{h}

% for MC diagrams                               
\usepackage{tikz}                               
\usetikzlibrary{arrows}                         

\usepackage{dcolumn} % for decimal point column alignment in tables

%: Specific notations 
% Specific notations: highlighted while in draft 
% \newcommand{\CAH}[1]{{\boldsymbol{\color{magenta}#1}}}
% \newcommand{\CAL}[1]{{\boldsymbol{\color{cyan}#1}}}
% \newcommand{\CAS}[1]{{\boldsymbol{\color{darkgreen}#1}}}

\everymath{\color{\eqcolor}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://tex.stackexchange.com/questions/33969/changing-font-size-of-selected-slides-in-beamer
% \usepackage{lipsum} % lorem ipsum

% \newcommand\Fontvi{\footnotesize\selectfont}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Evaluating Exponential Integrators for Markov Chain Ion Channel Models}
\author{Tom\'a\v s Star\'y, Vadim N. Biktashev }
\institute{\footnotesize 
  College of Engineering, Mathematics and Physical Sciences \\[1ex]
  \includegraphics[width=0.3\linewidth]{fig/exeLogo.pdf} 
}
\date{\it
  Computing in Cardiology, Nice, \\
 Wed 9 Sep, 2015
}


% \useoutertheme[subsection=false]{smoothbars}

% \setbeamertemplate{note page}[plain]

% \newcommand{\compresslist}{ % Define a command to reduce spacing within itemize/enumerate environments, this is used right after \begin{itemize} or \begin{enumerate}
% \setlength{\itemsep}{1pt}
% \setlength{\parskip}{0pt}
% \setlength{\parsep}{0pt}
% }

\newcommand{\highlight}[1]{\boxed{#1}}

\begin{document}
 
% title page
\frame{	\titlepage }

% outline
% \section[Outline]{}
% \frame{\tableofcontents}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ion Channel Models}
\begin{frame}
  \frametitle{Ion Channel Models}
  Composed of {\em gates}:
  {\color{\eqcolor}
    \begin{align*}
      \ddt{\y} = \alpha(\vm) (1-\y) - \beta(\vm) \y 
    \end{align*}}
  % 
  \begin{itemize}
  \item $\y$ -- open probability of the gate
  \item $\alpha$ -- opening transition rate
  \item $\beta$ -- closing transition rate
  \item $\vm$ -- membrane voltage
  \end{itemize}
  %
  \uncover<2>{
  Generalized by {\em Markov chain} states:
  {\color{\eqcolor}
    \begin{align*}
      \ddt{\vec \x} = \mM(\vm,\c)\, \vec \x
    \end{align*}}
  % 
  \begin{itemize}
  \item $\vec\x$ -- vector of state occupancies
  \item $\mM$ -- transition rates matrix
  \item $\c$ -- ionic concentration
  \end{itemize}
  }% uncover 2
\end{frame}

\section{Integration Methods}
\subsection{Gate Models}
\begin{frame}
  \frametitle{Gate Models}
  Time-stepping through time discretization $\t_n = \t_0 + n \dt$ \\
  e.g. simplest -- forward Euler method:
  {\color{\eqcolor}
    \begin{align*}
      \y_{n+1} = \y_n + \dt \ddt{\y_n}
    \end{align*}}
  %
  \vspace{-1.5em}
  \begin{multicols}{2}
    \begin{itemize}
    \item $\y_n\approx\y(\t_n)$
    \item $\dt$ -- time step
    \end{itemize}
  \end{multicols}
  \uncover<2->{\emph{Numerically unstable} for large $\dt$.\\[1.5ex]}
  \uncover<3->{
  Rush-Larsen solution method
  {\color{\eqcolor}
  \begin{align*}
    \y_{n+1} = \ybar(\vm_n) - \left(\ybar(\vm_n) - \y_n\right)
    \exp\left(-\frac{\dt}{\tC(\vm_n)}\right)
  \end{align*}}
  \vspace{-0.5em}
  \vspace{-1em}
  \begin{itemize}
  \item $\ybar$ -- steady state solution ($\t\rightarrow \infty$, voltage ``frozen'' at $\vm_n$)
  \item $\tC$ -- time constant
  \end{itemize}
  }
  \uncover<4>{\emph{Not directly applicable} to Markov chain models.}
\end{frame}

\subsection{Markov Chain Models}
\begin{frame}
  \frametitle{Markov Chain Models}
  We extend the exponential time differentiation for Markov chain
  {\color{\eqcolor}
    \begin{align*}
      \vec \x_{n+1} = \exp\left(\mM(\vm_n,\c_n) \dt \right) \vec \x_n 
    \end{align*}}
  \uncover<2->{
    Matrix exponential:
    % 
    {% \scriptsize
      \color{\eqcolor}
      \begin{align*}
        &\exp\left(\mM \dt \right) =
          \sum_{\Ej = 0}^{\infty} \frac{\mM^\Ej \dt^\Ej}{\Ej!}
          \uncover<3->{ = \sum_{\Ej = 0}^{\infty} \frac{(\eM \eD \eM^{-1})^\Ej \dt^\Ej}{\Ej!}}
          \uncover<4->{
          =\\ &\sum_{\Ej = 0}^{\infty} \frac{ \eM \eD \eM^{-1} \eM \eD \eM^{-1} \hdots \eM \eD \eM^{-1}\dt^\Ej}{\Ej!}
                =\sum_{\Ej = 0}^{\infty} \frac{ \eM  \eD \eD \hdots \eD  \eM^{-1}\dt^\Ej}{\Ej!}
                =\\ &\eM\left(\sum_{\Ej = 0}^{\infty} \frac{ \eD^\Ej  \dt^\Ej}{\Ej!}\right)\eM^{-1}}
                                                \uncover<5->{=
                                                \highlight{\eM\exp{(\eD \dt)}\eM^{-1}}
                                                }
      \end{align*}}
    \begin{itemize}
      \vspace{-0.5em}
      \uncover<3->{\item $\mM = \eM \eD \eM^{-1}$ -- eigenvalue decomposition
      \item matrices: $\eM$ -- e-vectors in columns, $\eD$ -- e-values on diagonal}
      \uncover<4->{\item $\eM^{-1} \eM = \I$ -- identity matrix}
      \uncover<4->{\item $\I\eD = \eD$}
    }% uncover 2
  \end{itemize}
\end{frame}

\subsection{Tabulation}
\begin{frame}
  \frametitle{Tabulation}
  To avoid expensive e-values and e-vectors computations at each time step:
    \begin{itemize}
    \uncover<2->{\item save the matrices $\eM(\tilde \vm)$ and $\eD(\tilde \vm)$ for a fine
      grid of physiological voltages: $\tilde \vm = (-100, 70)$~mV
      with the step 0.01~mV}
    \uncover<3->{\item before integration starts compute: \\ $\Tab(\tilde \vm) =
      \eM(\tilde \vm) \exp( \eD(\tilde \vm) \dt)
      \eM(\tilde \vm)^{-1}$}
    \uncover<4->{\item get numerical solution:
      {\color{\eqcolor}
      \begin{align*}
        \color{\eqcolor}
        \vec \x_{n+1} = \Tab(\tilde \vm_{j(n)}) \vec \x_n
      \end{align*}}
    where $\tilde \vm_{j(n)} \approx \vm_n$ and $\Tab(\tilde
      \vm_{j(n)})$ is quickly found in the pre-computed look-up table}
    \end{itemize}
\end{frame}

\section{Ionic Channels}
\subsection{RyR Channel}

\begin{frame}
  \frametitle{RyR Channel}
  \begin{minipage}{0.40\linewidth}
    \input{ryrmc.tex}    \vspace{3.50em}\\
    \uncover<2->{
      \includegraphics[width=1.0\linewidth]{ryr-inst.pdf}}\\
    \uncover<3->{
    \includegraphics[width=1.0\linewidth]{ryr-tr.pdf}}\\
  \end{minipage}
  \begin{minipage}{0.58\linewidth}
    % \uncover<4->{
    %   \begin{tabular}[t]{l|l|l}
    %   $\caiss(\t)$& $\csqn$& const.\\
    %   \hline
    %   \uncover<5->{$\alp{}$'s}\uncover<8->{, $\gam{}$'s}&
    %   \uncover<7->{$\del{}$'s}&
    %   \uncover<6->{$\bet{}$'s}\\
    % \end{tabular}}
    \uncover<3->{
      Transition rates:
      {\scriptsize
      \color{\eqcolor}
      \begin{align*}
        \mM(\caiss,\csqn)
        \uncover<4->{=
        \left(\begin{array}{l|l}
                \mB & 0 \\\hline 
                0 & \mB 
              \end{array}\right)+}
                    \uncover<5->{\mC}
                    \uncover<4>{\hspace{-1em}\hdots}
      \end{align*}}}
    \uncover<4->{    
      \begin{itemize}
      \item  $\alp{}$'s, $\bet{}$'s -- fast $\mB(\caiss(\t))$
        \uncover<5->{\item $\gam{}$'s, $\del{}$'s -- slow  $\mC(\dots)$}
      % $\norm{\mC(\dots)}\lesssim1\,\ms^{-1}$
    \end{itemize}}
    % Forward Euler limited by instability issues for $dt \ge 7$.
    \uncover<6->{
      Solved as
    {\color{\eqcolor}
    \begin{align*}
      &\vec\vv_{n+1/2}=\exp\left(\dt\,\mB(\t_n)\right)\,\vec\vv_n\\
      &\vec \w_{n+1/2}=\exp\left(\dt\,\mB(\t_n)\right)\,\vec \w_n\\
\uncover<7->{      &\vec\u_{n+1}  =\vec\u_{n+1/2} 
      + \dt\,\mC(\t_n)\,\vec\u_{n+1/2}}
    \end{align*}}
  where $\vec{v}=(I_1, \dots, I_5)$,\\ $\vec{\w}=(C_1,\dots,C_4,O_1)$ 
\uncover<7->{  and $\vec \u =(\vec \vv,\vec \w)$}}
  \end{minipage}
\end{frame}

\subsection{ical Channel}

\begin{frame}
  \frametitle{$\ical$ Channel}
  \begin{minipage}{0.50\linewidth}
  \input{icalmc.tex}
  \end{minipage}
  \begin{minipage}{0.48\linewidth}
    \begin{itemize}
    \item forward Euler instability at $\sim 37$~$\mus$ 
        \uncover<2->{\item two identical layers with \\ $\vm$ dependent transitions}
        \uncover<3->{\item vertical trans. controlled by $\cai$ dependent $\delta$, $\theta$}
          \uncover<4->{
          \item Simplifies as
            \begin{itemize}
            \item a single layer $\ddt{\vec \x} = \mM(\vm) \vec \x $
              % {\color{\eqcolor}
                % \begin{align*}
                %   &\ddt{\vec \x} = \mM(\vm) \vec \x 
                % \end{align*}}
            }
            \uncover<5->{
            \item and a gate model $\ddt{\q} = \theta (1-\q) - \delta \q$
              % \begin{align*}
              %   \hspace{-3em}\ddt{\q} = \theta(\cai) (1-\q) -\\ \delta(\cai) \q
              % \end{align*}
            }
          \end{itemize}

    \end{itemize}
  \end{minipage}\vspace{3.0em}\\
  \uncover<6->{
    \begin{itemize}
    \item use exponential solvers for both parts
    \item fraction of open channels is given by $p = \q O$
    \end{itemize}
  }  
\end{frame}

\section{Results and Conclusions}

\begin{frame}
  \frametitle{Results and Conclusions}
  \includegraphics[width=1.0\linewidth]{summeth.pdf}

    % \begin{minipage}{0.5\linewidth}
      \begin{itemize}
        \uncover<2->{ \item Time step increase from $\sim 6$~$\mus$ to
          $\sim 180$~$\mus$}
        \uncover<2->{\item 27-fold reduction of computational time}
        \uncover<3->{\item time step limited by accuracy requirements}
        \uncover<3->{ \item instability at higher time steps due to non-gating variables ($\nai$ and $\ki$) }
      \uncover<4->{\item addressing instability allows to consider higher order schemes}
      \end{itemize}
  %   \end{minipage}
  % \begin{minipage}{0.48\linewidth}
  %   \uncover<3->{\includegraphics[width=1.0\linewidth]{tab.pdf}}
  % \end{minipage}
\end{frame}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Conclusions}

\begin{frame}
\begin{thebibliography}{1}

\bibitem{Hodgkin1952}
A.~L. Hodgkin, A.~F. Huxley.
\newblock A quantitative description of membrane current and its application to
  conduction and excitation in nerve.
\newblock {\em J Physiol} 1952, 117(4):500--544.

\bibitem{Rush1978}
S.~Rush, H.~Larsen.
\newblock A practical algorithm for solving dynamic membrane equations.
\newblock {\em IEEE Trans Biomed Eng} 1978, 25(4):389--392.

\bibitem{Faber2007a}
  Faber GM, Silva J, Livshitz L, Rudy Y.
  \newblock Kinetic properties of the cardiac {L}-type {Ca$^{2+}$} channel and
  its role in myocyte electrophysiology: a theoretical investigation.
  \newblock {\em Biophys J} 2007;\hspace{0pt}92(5):1522--1543.

\bibitem{Stary2015}
  T.~Stary, V.~N.~Biktashev
  \newblock Exponential integrators for a Markov chain model of the fast sodium
  channel of cardiomyocytes.
  \newblock {\em IEEE Trans Biomed Eng} 2015;\hspace{0pt}62(4):1070--1076.

\end{thebibliography}
  
\end{frame}

\end{document}
